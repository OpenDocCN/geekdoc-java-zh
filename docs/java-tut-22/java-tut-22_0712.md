# 关系数据库概述

> 原文：[`docs.oracle.com/javase/tutorial/jdbc/overview/database.html`](https://docs.oracle.com/javase/tutorial/jdbc/overview/database.html)

数据库是一种以便于检索信息的方式存储信息的手段。简单来说，关系数据库是以行和列的形式呈现信息的数据库。表被称为关系，因为它是相同类型对象（行）的集合。表中的数据可以根据共同的键或概念相关联，从表中检索相关数据的能力是关系数据库这个术语的基础。数据库管理系统（DBMS）处理数据的存储、维护和检索方式。在关系数据库的情况下，关系数据库管理系统（RDBMS）执行这些任务。本书中使用的 DBMS 是一个包括 RDBMS 在内的通用术语。

## 完整性规则

关系表遵循某些完整性规则，以确保它们包含的数据保持准确并始终可访问。首先，关系表中的行应该都是不同的。如果有重复的行，解决哪一个是正确选择的问题可能会出现问题。对于大多数 DBMS，用户可以指定不允许重复行，如果这样做，DBMS 将阻止添加任何重复现有行的行。

传统关系模型的第二个完整性规则是列值不能是重复组或数组。数据完整性的第三个方面涉及空值的概念。数据库通过使用空值来指示缺失值的情况。它不等同于空白或零。空白被认为等于另一个空白，零等于另一个零，但两个空值不被视为相等。

当表中的每一行都不同时，可以使用一个或多个列来标识特定行。这个唯一的列或列组称为主键。任何作为主键的列都不能为 null；如果是，包含它的主键将不再是完整的标识符。这个规则称为实体完整性。

`Employees`表展示了一些关系数据库概念。它有五列和六行，每行代表一个不同的雇员。

`Employees`表

| `员工编号` | `名` | `姓` | `出生日期` | `车牌号` |
| --- | --- | --- | --- | --- |
| 10001 | 阿克塞尔 | 华盛顿 | 43 年 8 月 28 日 | 5 |
| 10083 | 阿维德 | 沙玛 | 54 年 11 月 24 日 | null |
| 10120 | 乔纳斯 | 金斯伯格 | 69 年 1 月 1 日 | null |
| 10005 | 弗洛伦斯 | 沃约科夫斯基 | 71 年 7 月 4 日 | 12 |
| 10099 | 肖恩 | 华盛顿 | 66 年 9 月 21 日 | null |
| 10035 | 伊丽莎白 | 山口 | 59 年 12 月 24 日 | null |

该表的主键通常会是员工编号，因为每个员工编号都保证是不同的。（数字比字符串更有效率用于比较。）也可以使用 `First_Name` 和 `Last_Name`，因为两者的组合在我们的示例数据库中也只标识一行。仅使用姓氏将不起作用，因为有两个姓氏为“Washington”的员工。在这种特殊情况下，名字都是不同的，因此可以想象使用该列作为主键，但最好避免使用可能出现重复的列。如果 Elizabeth Yamaguchi 在这家公司找到工作，而主键是 `First_Name`，则关系数据库管理系统将不允许添加她的名字（如果已经指定不允许重复）。因为表中已经有一个 Elizabeth，再添加一个将使主键无法作为标识一行的方法。请注意，虽然使用 `First_Name` 和 `Last_Name` 是这个示例的唯一复合键，但在更大的数据库中可能不是唯一的。还要注意，`Employees` 表假设每个员工只能有一辆车。

## `SELECT` 语句

SQL 是一种设计用于与关系数据库一起使用的语言。有一组被认为是标准的基本 SQL 命令，被所有关系数据库管理系统使用。例如，所有关系数据库管理系统都使用 `SELECT` 语句。

`SELECT` 语句，也称为查询，用于从表中获取信息。它指定一个或多个列标题，一个或多个要选择的表，以及一些选择条件。关系数据库管理系统返回满足所述要求的列条目的行。例如，以下 `SELECT` 语句将获取拥有公司车辆的员工的名字和姓氏：

```java
SELECT First_Name, Last_Name
FROM Employees
WHERE Car_Number IS NOT NULL

```

符合要求（`Car_Number` 列中不为 null 的行集）的结果集如下。对于满足要求的每一行，都会打印出名字和姓氏，因为 `SELECT` 语句（第一行）指定了列 `First_Name` 和 `Last_Name`。`FROM` 子句（第二行）给出了将从中选择列的表。

| `FIRST_NAME` | `LAST_NAME` |
| --- | --- |
| Axel | Washington |
| Florence | Wojokowski |

以下代码生成一个包含整个表的结果集，因为它要求表 Employees 中的所有列没有限制（没有 `WHERE` 子句）。请注意，`SELECT *` 意味着“`SELECT` 所有列”。

```java
SELECT *
FROM Employees

```

## `WHERE` 子句

`SELECT` 语句中的 `WHERE` 子句提供了选择值的条件。例如，在以下代码片段中，只有在列 `Last_Name` 以字符串 'Washington' 开头的行中才会选择值。

```java
SELECT First_Name, Last_Name
FROM Employees
WHERE Last_Name LIKE 'Washington%'

```

关键字`LIKE`用于比较字符串，并提供了可以使用通配符的功能。例如，在上面的代码片段中，'Washington'末尾有一个百分号(`%`)，表示任何包含字符串'Washington'加零个或多个额外字符的值都将满足这个选择条件。因此，'Washington'或'Washingtonian'都会匹配，但'Washing'不会。`LIKE`子句中使用的另一个通配符是下划线(`_`)，代表任意一个字符。例如，

```java
WHERE Last_Name LIKE 'Ba_man'

```

会匹配'Barman'、'Badman'、'Balman'、'Bagman'、'Bamman'等等。

下面的代码片段有一个使用等号(`=`)比较数字的`WHERE`子句。它选择了被分配车辆 12 的员工的名字和姓氏。

```java
SELECT First_Name, Last_Name
FROM Employees
WHERE Car_Number = 12

```

下一个代码片段选择了员工编号大于 10005 的员工的名字和姓氏：

```java
SELECT First_Name, Last_Name
FROM Employees
WHERE Employee_Number > 10005

```

`WHERE`子句可能会变得相当复杂，包含多个条件，在一些数据库管理系统中还可能有嵌套条件。本概述不会涵盖复杂的`WHERE`子句，但以下代码片段有一个带有两个条件的`WHERE`子句；这个查询选择了员工编号小于 10100 且没有公司车的员工的名字和姓氏。

```java
SELECT First_Name, Last_Name
FROM Employees
WHERE Employee_Number < 10100 and Car_Number IS NULL

```

一种特殊类型的`WHERE`子句涉及连接，将在下一节中解释。

## 连接

关系数据库的一个显著特点是可以通过所谓的连接从多个表中获取数据。假设在检索拥有公司车辆的员工姓名后，想要找出谁拥有哪辆车，包括车辆的品牌、型号和年份。这些信息存储在另一个表`Cars`中：

`Cars`表

| `Car_Number` | `品牌` | `型号` | `年份` |
| --- | --- | --- | --- |
| 5 | 本田 | 思域 DX | 1996 |
| 12 | 丰田 | 卡罗拉 | 1999 |

为了将两个表关联起来，必须有一列同时出现在两个表中。这一列在一个表中必须是主键，在另一个表中被称为外键。在这种情况下，出现在两个表中的列是`Car_Number`，它是表`Cars`的主键，也是表`Employees`的外键。如果 1996 年本田思域被损坏并从`Cars`表中删除，那么`Car_Number`为 5 也必须从`Employees`表中删除，以保持所谓的参照完整性。否则，`Employees`表中的外键列(`Car_Number`)将包含一个不指向`Cars`表中任何内容的条目。外键必须为空或等于所引用表的现有主键值。这与主键不同，主键不可为空。在表`Employees`的`Car_Number`列中有几个空值，因为员工可能没有公司车。

以下代码要求输入拥有公司车辆的员工的名字和姓氏，以及这些车辆的制造商、型号和年份。请注意，`FROM`子句列出了`Employees`和`Cars`表，因为请求的数据包含在这两个表中。在列名之前使用表名和点号（`.`）表示哪个表包含该列。

```java
SELECT Employees.First_Name, Employees.Last_Name,
    Cars.Make, Cars.Model, Cars.Year
FROM Employees, Cars
WHERE Employees.Car_Number = Cars.Car_Number

```

这将返回一个类似以下的结果集：

| `FIRST_NAME` | `LAST_NAME` | `LICENSE_PLATE` | `MILEAGE` | `YEAR` |
| --- | --- | --- | --- | --- |
| John | Washington | ABC123 | 5000 | 1996 |
| Florence | Wojokowski | DEF123 | 7500 | 1999 |

## 常见的 SQL 命令

SQL 命令分为不同的类别，主要包括数据操作语言（DML）命令和数据定义语言（DDL）命令。DML 命令处理数据，无论是检索数据还是修改数据以保持其最新状态。DDL 命令创建或更改表以及其他数据库对象，如视图和索引。

以下是更常见的 DML 命令列表：

+   `SELECT — ` 用于从数据库中查询和显示数据。`SELECT`语句指定要包含在结果集中的列。应用程序中使用的 SQL 命令中绝大多数是`SELECT`语句。

+   `INSERT — ` 向表中添加新行。`INSERT`用于填充新创建的表或向已存在的表中添加新行（或多行）。

+   `DELETE — ` 从表中删除指定的行或一组行

+   `UPDATE — ` 改变表中某一列或一组列中的现有值

更常见的 DDL 命令如下：

+   `CREATE TABLE — ` 创建一个带有用户提供的列名的表。用户还需要为每个列中的数据指定一个类型。不同的关系型数据库管理系统具有不同的数据类型，因此用户可能需要使用元数据来确定特定数据库使用的数据类型。`CREATE TABLE`通常比数据操作命令使用频率低，因为表只创建一次，而添加或删除行或更改单个值通常更频繁发生。

+   `DROP TABLE — ` 删除所有行并从数据库中删除表定义。根据 SQL92，过渡级别的规范，JDBC API 实现需要支持`DROP TABLE`命令。但是，对于`DROP TABLE`的`CASCADE`和`RESTRICT`选项的支持是可选的。此外，当存在引用正在被删除的表的视图或完整性约束时，`DROP TABLE`的行为是由实现定义的。

+   `ALTER TABLE — ` 向表中添加或删除列。它还添加或删除表约束并更改列属性

## 结果集和游标

满足查询条件的行被称为结果集。结果集中返回的行数可以是零、一或多个。用户可以逐行访问结果集中的数据，游标提供了这样的功能。游标可以被看作是指向包含结果集行的文件的指针，并且该指针有能力跟踪当前正在访问的行。游标允许用户从顶部到底部处理结果集的每一行，因此可用于迭代处理。大多数数据库管理系统在生成结果集时会自动创建游标。

早期的 JDBC API 版本为结果集的游标增加了新的功能，允许它向前和向后移动，还允许它移动到指定的行或相对于另一行的位置。

更多信息请参见从结果集中检索和修改值。

## 事务

当一个用户正在访问数据库中的数据时，另一个用户可能同时访问相同的数据。例如，第一个用户正在同时更新表中的某些列，而第二个用户正在从同一表中选择列，这时第二个用户可能会得到部分旧数据和部分更新数据。因此，数据库管理系统使用事务来维护数据的一致状态（数据一致性），同时允许多个用户同时访问数据库（数据并发性）。

事务是由一个或多个 SQL 语句组成的逻辑工作单元。事务以提交或回滚结束，具体取决于数据一致性或数据并发性是否存在问题。提交语句将使事务中 SQL 语句产生的更改永久生效，而回滚语句将撤消事务中 SQL 语句产生的所有更改。

锁是一种机制，阻止两个事务同时操作相同的数据。例如，表锁会阻止在该表上存在未提交事务时删除该表。在某些数据库管理系统中，表锁还会锁定表中的所有行。行锁可以阻止两个事务修改同一行，或者阻止一个事务在另一个事务仍在修改该行时选择该行。

更多信息请参见使用事务。

## 存储过程

存储过程是一组可以通过名称调用的 SQL 语句。换句话说，它是可执行的代码，一个小型程序，执行特定任务，可以像调用函数或方法一样调用。传统上，存储过程是用特定于数据库管理系统的编程语言编写的。最新一代的数据库产品允许使用 Java 编程语言和 JDBC API 编写存储过程。用 Java 编程语言编写的存储过程在不同数据库管理系统之间是字节码可移植的。一旦编写了存储过程，它就可以被使用和重复使用，因为支持存储过程的数据库管理系统会将其存储在数据库中。查看使用存储过程获取有关编写存储过程的信息。

## 元数据

数据库存储用户数据，也存储关于数据库本身的信息。大多数数据库管理系统都有一组系统表，列出数据库中的表、每个表中的列名、主键、外键、存储过程等。每个数据库管理系统都有自己的函数来获取有关表布局和数据库功能的信息。JDBC 提供了 `DatabaseMetaData` 接口，驱动程序编写者必须实现该接口，以便其方法返回有关驱动程序和/或为其编写驱动程序的数据库管理系统的信息。例如，大量的方法返回驱动程序是否支持特定功能。这个接口为用户和工具提供了一种标准化的获取元数据的方式。一般来说，编写工具和驱动程序的开发人员最有可能关注元数据。
