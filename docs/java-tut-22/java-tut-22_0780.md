# 为什么选择 StAX？

> 原文：[`docs.oracle.com/javase/tutorial/jaxp/stax/why.html`](https://docs.oracle.com/javase/tutorial/jaxp/stax/why.html)

StAX 项目由 BEA 主导，得到了 Sun Microsystems 的支持，[JSR 173 规范](http://jcp.org/en/jsr/detail?id=173)于 2004 年 3 月通过了 Java 社区流程的最终批准投票。StAX API 的主要目标是通过公开一个简单的基于迭代器的 API，将“解析控制权交给程序员。这允许程序员请求下一个事件（拉取事件），并允许以过程化方式存储状态。” StAX 的创建是为了解决两种最常见解析 API，SAX 和 DOM，的限制。

## 流式处理与 DOM

一般来说，处理 XML 信息集有两种编程模型：**流式处理**和**文档对象模型**（DOM）。

DOM 模型涉及创建代表整个文档树和 XML 文档的完整信息集状态的内存对象。一旦在内存中，DOM 树可以自由导航和任意解析，因此为开发人员提供了最大的灵活性。然而，这种灵活性的代价是潜在的大内存占用和显著的处理器需求，因为整个文档的表示必须作为对象在内存中保持，以便在文档处理期间使用。在处理小型文档时，这可能不是问题，但随着文档大小的增加，内存和处理器需求可能会迅速升高。

流式处理是指一种编程模型，在应用程序运行时串行传输和解析 XML 信息集，通常是实时的，并且通常来自动态来源，其内容事先并不完全知晓。此外，基于流的解析器可以立即开始生成输出，并且信息集元素在使用后可以立即丢弃和进行垃圾回收。虽然提供了较小的内存占用、降低的处理器需求和在某些情况下更高的性能，但流处理的主要折衷是您只能在文档中的一个位置看到信息集状态。您基本上受限于文档的“纸板筒”视图，这意味着您需要在阅读 XML 文档之前知道要进行哪些处理。

在处理 XML 时，流式处理模型特别适用于应用程序具有严格的内存限制，比如在运行 Java 平台微版（Java ME 平台）的手机上，或者当应用程序需要同时处理多个请求时，比如在应用服务器上。实际上，可以说大多数 XML 业务逻辑都可以从流式处理中受益，并且不需要在内存中维护整个 DOM 树。

## 拉取解析与推送解析

流**拉取解析**是一种编程模型，其中客户端应用程序在需要与 XML 信息集交互时调用 XML 解析库的方法，即客户端只有在明确请求时才会获取（拉取）XML 数据。

流**推送解析**是一种编程模型，其中 XML 解析器在遇到 XML 信息集中的元素时向客户端发送（推送）XML 数据，即使客户端此时还没有准备好使用它。

在处理 XML 流时，拉取解析相比于推送解析提供了几个优势：

+   在拉取解析中，客户端控制应用程序线程，并且可以在需要时调用解析器的方法。相比之下，在推送处理中，解析器控制应用程序线程，客户端只能接受解析器的调用。

+   拉取解析库可以比推送库更小，与这些库交互的客户端代码也更简单，即使对于更复杂的文档。

+   拉取客户端可以使用单个线程同时读取多个文档。

+   StAX 拉取解析器可以过滤 XML 文档，使客户端不需要的元素被忽略，并且可以支持非 XML 数据的 XML 视图。

## StAX 使用案例

StAX 规范定义了 API 的许多用例：

+   数据绑定

    +   反编组 XML 文档

    +   将 XML 文档编组

    +   并行文档处理

    +   无线通信

+   简单对象访问协议（SOAP）消息处理

    +   解析简单可预测的结构

    +   解析具有前向引用的图形表示

    +   解析 Web 服务描述语言（WSDL）

+   虚拟数据源

    +   查看存储在数据库中的 XML 数据

    +   查看由 XML 数据绑定创建的 Java 对象中的数据

    +   将 DOM 树作为事件流导航

+   解析特定的 XML 词汇

+   管道化 XML 处理

对所有这些用例的完整讨论超出了本课程的范围。请参考 StAX 规范以获取更多信息。

## 将 StAX 与其他 JAXP API 进行比较

作为 JAXP 家族中的一个 API，StAX 可以与 SAX、TrAX 和 JDOM 等其他 API 进行比较。在后两者中，StAX 不像 TrAX 或 JDOM 那样强大或灵活，但也不需要太多内存或处理器负载才能发挥作用，并且在许多情况下，StAX 可以胜过基于 DOM 的 API。上面概述的相同论点，权衡 DOM 模型与流模型的成本/效益，在这里同样适用。

有鉴于此，最接近的比较可以在 StAX 和 SAX 之间进行，正是在这里 StAX 提供了许多情况下有益的功能；其中一些包括：

+   使用 StAX 的客户端通常比使用 SAX 的客户端更容易编码。虽然可以说 SAX 解析器稍微更容易编写，但 StAX 解析器的代码可能更小，客户端与解析器交互所需的代码更简单。

+   StAX 是一个双向 API，意味着它既可以读取又可以写入 XML 文档。SAX 只能读取，所以如果你想要写入 XML 文档，就需要另一个 API。

+   SAX 是一个推送 API，而 StAX 是一个拉取 API。上面概述的推送和拉取 API 之间的权衡在这里也适用。

以下表格总结了 StAX、SAX、DOM 和 TrAX 的比较特性。（表格改编自 Jeff Ryan 的文章[Does StAX Belong in Your XML Toolbox?](http://www.developer.com/xml/article.php/3397691)）。

XML 解析器 API 特性摘要

| 特性 | StAX | SAX | DOM | TrAX |
| --- | --- | --- | --- | --- |
| API 类型 | 拉取，流式 | 推送，流式 | 内存树 | XSLT 规则 |
| 使用便捷性 | 高 | 中 | 高 | 中 |
| XPath 能力 | 否 | 否 | 是 | 是 |
| CPU 和内存效率 | 良好 | 良好 | 各异 | 各异 |
| 仅向前 | 是 | 是 | 否 | 否 |
| 读取 XML | 是 | 是 | 是 | 是 |
| 写入 XML | 是 | 否 | 是 | 是 |
| 创建，读取，更新，删除 | 否 | 否 | 是 | 否 |
